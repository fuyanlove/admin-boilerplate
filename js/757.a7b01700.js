"use strict";(self["webpackChunkadmin"]=self["webpackChunkadmin"]||[]).push([[757],{7706:function(e,a,t){t.d(a,{G:function(){return o}});var l=t(6736);function o(e){return(0,l.n)().get("/api/cms/system/action/logs",{params:e})}},2325:function(e,a,t){t.d(a,{HO:function(){return i},Qx:function(){return n},p6:function(){return r}});var l=t(7484),o=t.n(l);function r(e,a="date"){if(e){if("date"===a)return o()(e).format("YYYY-MM-DD");if("time"===a)return o()(e).format("HH:mm:ss");if("datetime"===a)return o()(e).format("YYYY-MM-DD HH:mm:ss")}}function i(e){const a={};for(const t in e)null!==e[t]&&void 0!==e[t]&&""!==e[t]&&(a[t]=e[t]);return a}function n(e){return e||t(6215)}},8656:function(e,a,t){var l=t(7484),o=t.n(l);const r=[{label:"描述",prop:"desc",width:"200"},{label:"资源ID",prop:"source_id",width:"100"},{label:"IP地址",prop:"ip",width:"100"},{label:"User Agent",prop:"ua"},{label:"时间",prop:"time",width:"200",formatter:e=>o()(e.time).format("YYYY-MM-DD HH:mm:ss")}],i=[{label:"查询",value:"GET"},{label:"创建",value:"POST"},{label:"更新",value:"PUT"},{label:"删除",value:"DELETE"}];a.Z={tableHeader:r,methods:i}},7757:function(e,a,t){t.r(a),t.d(a,{default:function(){return v}});var l=t(6252),o=t(3577),r=t(9963);const i={class:"p-action-log c-main"},n={class:"u-user"},d={class:"u-action"},s=(0,l._)("span",{class:"u-label"},"时间范围：",-1),u=(0,l._)("span",{class:"u-div"},"-",-1),m={key:0};function p(e,a,t,p,c,h){const f=(0,l.up)("el-option"),g=(0,l.up)("el-select"),_=(0,l.up)("el-input"),w=(0,l.up)("el-col"),b=(0,l.up)("el-date-picker"),v=(0,l.up)("el-row"),D=(0,l.up)("el-table-column"),V=(0,l.up)("el-table"),k=(0,l.up)("el-pagination"),U=(0,l.Q2)("loading");return(0,l.wg)(),(0,l.iD)("div",i,[(0,l.Wm)(v,{class:"m-search",gutter:20},{default:(0,l.w5)((()=>[(0,l.Wm)(w,{xs:24,md:12,class:"u-info"},{default:(0,l.w5)((()=>[(0,l._)("div",n,[(0,l.Wm)(g,{placeholder:"用户",modelValue:c.form.user_id,"onUpdate:modelValue":a[0]||(a[0]=e=>c.form.user_id=e),style:{width:"100%"},filterable:"",remote:"","remote-method":h.remoteMethod,clearable:""},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(c.userList,(e=>((0,l.wg)(),(0,l.j4)(f,{key:e.id,label:e.wechat_name+" ("+e.name+")",value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue","remote-method"])]),(0,l._)("div",d,[(0,l.Wm)(g,{modelValue:c.form.method,"onUpdate:modelValue":a[1]||(a[1]=e=>c.form.method=e),placeholder:"动作",clearable:""},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(h.methods,(e=>((0,l.wg)(),(0,l.j4)(f,{key:e.value,value:e.value,label:e.label},{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(e.label)+" ("+(0,o.zw)(e.value)+") ",1)])),_:2},1032,["value","label"])))),128))])),_:1},8,["modelValue"])]),(0,l.Wm)(_,{modelValue:c.form.source_id,"onUpdate:modelValue":a[2]||(a[2]=e=>c.form.source_id=e),class:"u-user",placeholder:""},{prepend:(0,l.w5)((()=>[(0,l.Uk)("资源ID")])),_:1},8,["modelValue"])])),_:1}),(0,l.Wm)(w,{xs:24,md:12,class:"u-time"},{default:(0,l.w5)((()=>[s,(0,l.Wm)(b,{class:"u-date",modelValue:c.form.start_time,"onUpdate:modelValue":a[3]||(a[3]=e=>c.form.start_time=e),type:"datetime",placeholder:"选择开始时间"},null,8,["modelValue"]),u,(0,l.Wm)(b,{class:"u-date",modelValue:c.form.end_time,"onUpdate:modelValue":a[4]||(a[4]=e=>c.form.end_time=e),type:"datetime",placeholder:"选择结束时间"},null,8,["modelValue"])])),_:1}),(0,l.Wm)(w,{xs:24,md:24,class:"u-info"},{default:(0,l.w5)((()=>[(0,l.Wm)(_,{modelValue:c.form.search,"onUpdate:modelValue":a[5]||(a[5]=e=>c.form.search=e),placeholder:"从IP／用户代理(UA)／描述／路径中检索",class:"u-input",onKeyup:(0,r.D2)(h.loadData,["enter"]),clearable:""},{prepend:(0,l.w5)((()=>[(0,l.Uk)("搜索")])),_:1},8,["modelValue","onKeyup"])])),_:1})])),_:1}),(0,l.wy)(((0,l.wg)(),(0,l.j4)(V,{data:c.data,border:"",stripe:""},{default:(0,l.w5)((()=>[(0,l.Wm)(D,{label:"用户",prop:"user_id","class-name":"u-username",width:"150","show-overflow-tooltip":""},{default:(0,l.w5)((({row:e})=>[e.user?((0,l.wg)(),(0,l.iD)("span",m,(0,o.zw)(e.user.wechat_name||e.user.name||e.user_id),1)):(0,l.kq)("",!0)])),_:1}),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(h.tableHeader,(e=>((0,l.wg)(),(0,l.j4)(D,{key:e.prop,label:e.label,prop:e.prop,width:e.width,"show-overflow-tooltip":"","tooltip-options":{"popper-class":"u-table-tooltip"}},{default:(0,l.w5)((({row:a})=>[(0,l.Uk)((0,o.zw)(e.formatter?e.formatter(a):a[e.prop]),1)])),_:2},1032,["label","prop","width"])))),128))])),_:1},8,["data"])),[[U,c.loading]]),c.data.length?((0,l.wg)(),(0,l.j4)(k,{key:0,class:"m-pagination",currentPage:c.pagination.page,"onUpdate:currentPage":a[6]||(a[6]=e=>c.pagination.page=e),background:"",pageSize:c.pagination.limit,"onUpdate:pageSize":a[7]||(a[7]=e=>c.pagination.limit=e),layout:"prev, pager, next",total:c.pagination.total},null,8,["currentPage","pageSize","total"])):(0,l.kq)("",!0)])}var c=t(7706),h=t(2878),f=t(8656),g=t(2325),_={name:"ActionLog",data(){return{form:{search:"",method:"",start_time:"",end_time:"",source_id:"",user_id:""},loading:!1,data:[],pagination:{page:1,limit:15,total:0},userList:[]}},computed:{tableHeader(){return f.Z.tableHeader},methods(){return f.Z.methods},params(){return(0,g.HO)({search:this.form.search,method:this.form.method,start_time:this.form.start_time,end_time:this.form.end_time,source_id:this.form.source_id,user_id:this.form.user_id})},reset_params(){return[this.form.search,this.form.method,this.form.start_time,this.form.end_time,this.form.source_id,this.form.user_id]},page_params(){return{page:this.pagination.page,limit:this.pagination.limit}}},watch:{reset_params:{handler(){this.pagination.page=1},deep:!0},params:{handler(){this.loadData()},deep:!0,immediate:!0},page_params:{handler(){this.loadData()},deep:!0}},methods:{avatarUrl:g.Qx,loadData:function(){this.loading=!0,(0,c.G)({...this.params,...this.page_params}).then((e=>{this.data=e.data.data.list||[],this.pagination.total=e.data.data.total||0})).finally((()=>{this.loading=!1}))},remoteMethod(e){(0,h.Vo)({search:e,page:1,limit:10}).then((e=>{this.userList=e.data.data.list||[]}))}}},w=t(3744);const b=(0,w.Z)(_,[["render",p]]);var v=b},6215:function(e,a,t){e.exports=t.p+"img/logo.8222117d.svg"}}]);
//# sourceMappingURL=757.a7b01700.js.map