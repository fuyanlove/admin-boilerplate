"use strict";(self["webpackChunkadmin"]=self["webpackChunkadmin"]||[]).push([[31,152],{9152:function(e,a,r){r.r(a),r.d(a,{default:function(){return p}});var s=r(6252);const t={class:"p-account-add"},o={key:0};function l(e,a,r,l,d,m){const n=(0,s.up)("el-input"),u=(0,s.up)("el-form-item"),i=(0,s.up)("el-button"),c=(0,s.up)("el-form");return(0,s.wg)(),(0,s.iD)("div",t,[r.account.id?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("h1",o,"创建账号")),(0,s.Wm)(c,{model:d.formData,rules:m.rules,"label-width":"80px",size:"large",ref:"form"},{default:(0,s.w5)((()=>[(0,s.Wm)(u,{label:"账号",prop:"username",required:""},{default:(0,s.w5)((()=>[(0,s.Wm)(n,{modelValue:d.formData.username,"onUpdate:modelValue":a[0]||(a[0]=e=>d.formData.username=e),placeholder:"请输入登录用户名",disabled:!!r.account.id},null,8,["modelValue","disabled"])])),_:1}),r.account.id?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(u,{key:0,label:"密码",prop:"password",required:""},{default:(0,s.w5)((()=>[(0,s.Wm)(n,{modelValue:d.formData.password,"onUpdate:modelValue":a[1]||(a[1]=e=>d.formData.password=e),type:"password",minlength:6,maxlength:20,"show-password":"",placeholder:"请输入密码"},null,8,["modelValue"])])),_:1})),(0,s.Wm)(u,{label:"昵称",prop:"nickname",required:""},{default:(0,s.w5)((()=>[(0,s.Wm)(n,{modelValue:d.formData.nickname,"onUpdate:modelValue":a[2]||(a[2]=e=>d.formData.nickname=e),placeholder:"请输入昵称"},null,8,["modelValue"])])),_:1}),r.account.id?((0,s.wg)(),(0,s.iD)(s.HY,{key:1},[(0,s.Wm)(u,{label:"电话",prop:"phone"},{default:(0,s.w5)((()=>[(0,s.Wm)(n,{modelValue:d.formData.phone,"onUpdate:modelValue":a[3]||(a[3]=e=>d.formData.phone=e),placeholder:"输入电话"},null,8,["modelValue"])])),_:1}),(0,s.Wm)(u,{label:"邮箱",prop:"email"},{default:(0,s.w5)((()=>[(0,s.Wm)(n,{modelValue:d.formData.email,"onUpdate:modelValue":a[4]||(a[4]=e=>d.formData.email=e),placeholder:"输入邮箱"},null,8,["modelValue"])])),_:1}),(0,s.Wm)(u,{label:"备注",prop:"remark"},{default:(0,s.w5)((()=>[(0,s.Wm)(n,{modelValue:d.formData.remark,"onUpdate:modelValue":a[5]||(a[5]=e=>d.formData.remark=e),placeholder:"输入备注"},null,8,["modelValue"])])),_:1})],64)):(0,s.kq)("",!0),(0,s.Wm)(u,{class:"m-form-actions"},{default:(0,s.w5)((()=>[(0,s.Wm)(i,{type:"primary",onClick:m.onSubmit,loading:d.processing},{default:(0,s.w5)((()=>[(0,s.Uk)("提交")])),_:1},8,["onClick","loading"]),(0,s.Wm)(i,{onClick:m.onCancel,disabled:d.processing},{default:(0,s.w5)((()=>[(0,s.Uk)("取消")])),_:1},8,["onClick","disabled"])])),_:1})])),_:1},8,["model","rules"])])}r(7658);var d=r(2878),m=r(6486),n=r(5108),u={name:"AccountAdd",props:{account:{type:Object,default:()=>({})}},data(){return{formData:{username:"",password:"",nickname:"",group:512,phone:"",email:"",status:1,avatar:"",remark:""},processing:!1}},computed:{rules(){const e={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:4,max:20,message:"长度在 4 到 20 个字符",trigger:"blur"},{message:"用户名已存在",trigger:"blur",validator:this.checkUsername}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}],nickname:[{required:!0,message:"请输入昵称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],phone:[{pattern:/^1[3456789]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]};return this.account.id&&(delete e.password,delete e.username),e}},watch:{account:{immediate:!0,deep:!0,handler(e){this.formData=Object.assign({},this.formData,(0,m.pick)(e,Object.keys(this.formData)))}}},methods:{async checkUsername(e,a,r){try{const e={search:a};this.account.id&&(e.id=this.account.id);const s=await(0,d.pt)(e);s.data.data.is_exist?r(new Error("用户名已存在")):r()}catch(s){r(new Error(s))}},onCancel(){this.$router.push({name:"account-list"})},onSubmit(){this.$refs.form.validate(((e,a)=>{if(e)if(this.processing=!0,this.account.id){const e=(0,m.omit)(this.formData,["password","username"]);(0,d.sG)(this.account.id,e).then((()=>{this.$message.success("修改成功"),this.$router.push({name:"account-list"})})).finally((()=>{this.processing=!1}))}else{const e=(0,m.pick)(this.formData,["username","password","nickname","group"]);(0,d.o1)(e).then((()=>{this.$message.success("添加成功"),this.$router.push({name:"account-list"})})).finally((()=>{this.processing=!1}))}else n.log("error submit!!!",a)}))}}},i=r(3744);const c=(0,i.Z)(u,[["render",l]]);var p=c},7031:function(e,a,r){r.r(a),r.d(a,{default:function(){return b}});var s=r(6252);const t={class:"p-account-add p-account-edit"},o=(0,s._)("h1",null,"编辑账号",-1);function l(e,a,r,l,d,m){const n=(0,s.up)("account-add"),u=(0,s.up)("el-tab-pane"),i=(0,s.up)("reset-pwd"),c=(0,s.up)("el-tabs");return(0,s.wg)(),(0,s.iD)("div",t,[o,(0,s.Wm)(c,{modelValue:d.current,"onUpdate:modelValue":a[0]||(a[0]=e=>d.current=e)},{default:(0,s.w5)((()=>[(0,s.Wm)(u,{label:"账号信息",name:"account",lazy:""},{default:(0,s.w5)((()=>[(0,s.Wm)(n,{account:d.data},null,8,["account"])])),_:1}),(0,s.Wm)(u,{label:"修改密码",name:"password",lazy:""},{default:(0,s.w5)((()=>[(0,s.Wm)(i)])),_:1})])),_:1},8,["modelValue"])])}var d=r(9152);const m={class:"p-reset-pwd"};function n(e,a,r,t,o,l){const d=(0,s.up)("el-input"),n=(0,s.up)("el-form-item"),u=(0,s.up)("el-button"),i=(0,s.up)("el-form");return(0,s.wg)(),(0,s.iD)("div",m,[(0,s.Wm)(i,{ref:"form",model:o.form,rules:o.rules,"label-width":"80px",size:"large"},{default:(0,s.w5)((()=>[(0,s.Wm)(n,{label:"新密码",prop:"password1",required:""},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{modelValue:o.form.password1,"onUpdate:modelValue":a[0]||(a[0]=e=>o.form.password1=e),type:"password","show-password":"",placeholder:"输入新密码"},null,8,["modelValue"])])),_:1}),(0,s.Wm)(n,{label:"再次输入",prop:"password2",required:""},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{modelValue:o.form.password2,"onUpdate:modelValue":a[1]||(a[1]=e=>o.form.password2=e),type:"password","show-password":"",placeholder:"再次输入新密码"},null,8,["modelValue"])])),_:1}),(0,s.Wm)(n,{class:"m-form-actions"},{default:(0,s.w5)((()=>[(0,s.Wm)(u,{type:"primary",onClick:l.submit,loading:o.processing},{default:(0,s.w5)((()=>[(0,s.Uk)("提交")])),_:1},8,["onClick","loading"])])),_:1})])),_:1},8,["model","rules"])])}var u=r(2878),i=r(5108),c={name:"ResetPwd",components:{},data(){return{form:{password1:"",password2:""},rules:{password1:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}],password2:[{required:!0,message:"再次输入新密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"},{validator:this.checkPassword,trigger:"blur"}]},processing:!1}},computed:{id(){return this.$route.params.id}},methods:{submit(){this.$refs.form.validate(((e,a)=>{if(e){const e={password1:this.form.password1,password2:this.form.password2};this.processing=!0,(0,u.qd)(this.id,e).then((()=>{this.$message.success("修改成功"),this.form={password1:"",password2:"",confirm_pwd:""},this.$refs.form.resetFields()})).finally((()=>{this.processing=!1}))}else i.log("error submit!!",a)}))},validateConfirmPwd(e,a,r){a!==this.form.password1?r(new Error("两次输入密码不一致")):r()}}},p=r(3744);const f=(0,p.Z)(c,[["render",n]]);var h=f,w={name:"AccountEdit",components:{AccountAdd:d["default"],ResetPwd:h},data(){return{current:"account",data:{}}},computed:{id(){return this.$route.params.id}},watch:{id:{immediate:!0,handler(e){e&&this.getData()}}},methods:{getData(){(0,u.Te)(this.id).then((e=>{this.data=e.data.data}))}}};const g=(0,p.Z)(w,[["render",l]]);var b=g}}]);
//# sourceMappingURL=31.1d5112e2.js.map